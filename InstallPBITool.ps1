# Define the JSON structure
$jsonContent = @{
    version = "1.0.0"
    name = "PQ Shared Library"
    description = "Launches PowerShell and runs a script that allows you to query and copy shared PQ Code from Chris Aragao's GitHub repository."
    path = ""
    arguments = ""
    iconData = "image/png;base64,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"
}

# Get the current directory and append GetPQShared.exe
$currentDirectory = (Get-Location).Path
$jsonContent.path = Join-Path -Path $currentDirectory -ChildPath "GetPQShared.exe"

# Convert the JSON content to a JSON string
$jsonString = $jsonContent | ConvertTo-Json -Depth 10

# Define the output file path
$outputFilePath = "C:\Program Files (x86)\Common Files\Microsoft Shared\Power BI Desktop\External Tools\PQShared.pbitool.json"

# Ensure the directory exists
$outputDirectory = [System.IO.Path]::GetDirectoryName($outputFilePath)
if (-not (Test-Path -Path $outputDirectory)) {
    New-Item -ItemType Directory -Path $outputDirectory -Force
}

# Save the JSON string to the output file, overwriting if it already exists
Set-Content -Path $outputFilePath -Value $jsonString -Force

Write-Output "JSON file created and saved to $outputFilePath"